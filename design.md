## 一、核心设计思路：把“恋爱/社交”做成可计算的人生系统

### 1) 主题与体验目标

* 表层爽点：从社恐/普通人一路升级成“社交王者”，最终达成**“魔都顶配伴侣的长期承诺/婚姻”**（你要的“诺贝尔奖”替换目标）。
* 内核笑点：把现实中玄学的恋爱过程，拆成可运行的“**多目标优化问题**”：时间、金钱、精力、魅力、边界感、信誉、社交圈层、职业发展、情绪稳定……你永远缺一样。
* 叙事基调：写实 + 荒诞。写实来自约束（钱/时间/情绪），荒诞来自事件（误会、修罗场、朋友圈舆论、偶遇贵人、离谱巧合）。

### 2) 核心循环（照着青椒那套来）

> 选行动（约会/学习提升/社交拓展/工作赚钱/健身形象/休息回血…）
> → 资源变化（钱、精力、形象、沟通、声誉…）
> → 触发事件（随机 + 条件触发 + 事件链）
> → 关系变化（好感、信任、边界、投入、冲突）
> → 解锁更高阶场景与头衔（圈层、资源、对象质量、事件难度）
> → 循环加速

### 3) 资源系统：恋爱不是一条线，是一堆互相打架的条

建议至少有这几类“硬资源”与“软资源”：

**硬资源**

* 时间（回合制：天/周）
* 金钱（消费与投资）
* 精力/健康（熬夜、情绪消耗、失恋debuff）
* 城市移动成本（上海是超现实“地图”）

**软资源（决定你能不能不翻车）**

* 外在形象（穿搭/体态/卫生习惯）
* 沟通能力（倾听、表达、冲突处理）
* 情绪稳定（焦虑、依恋风格会影响对话选项）
* 声誉/信用（朋友圈舆论、靠谱程度）
* 边界感（越界会直接触发负面事件链）

这套资源的目的：让玩家**每次选择都带痛感**，从而好玩。

---

## 二、角色系统：把“女神”做成可模拟的“人”，而不是奖杯

你想要“顶级白富美”的目标没问题，但游戏里必须把 NPC 设计成：

* 有偏好、有底线、有生活、有反应的主体
* 能因为你的行为改变对你的判断（尤其是**信任/安全感**）

### 1) 每个可恋爱角色的核心参数（建议）

* `attraction`（吸引）：外在与气质是否对路（偏静/偏闹/偏成熟等）
* `trust`（信任）：是否觉得你靠谱（最重要）
* `comfort`（舒适度）：和你相处是否轻松
* `respect`（尊重感）：你是否尊重她的边界与选择
* `investment`（投入）：她愿意为关系付出的程度
* `conflict_meter`（冲突度）：近期矛盾累积
* `availability`（可约程度）：她的日程/忙碌周期
* `flags`：事件标记（吵过架、见过朋友、见过父母等）

### 2) 偏好系统（让每个人“口味不同”）

每个角色有一组偏好权重，例如：

* 偏好：幽默/上进/体贴/审美/生活方式/边界感/家庭观、调情
* 反感：PUA话术、迟到、不诚实、炫耀、控制欲、调戏

你会发现：这样做出来，“海王策略”未必是最优解——因为**声誉系统**会反噬。

---

## 三、头衔与终局：按你给的映射，但更可玩也更合规

你给的改写我建议这样落地（保留梗，但不露骨）：

* **讲师头衔** → 「**初恋里程碑**」：与第一位“女神级”对象达成**明确的双向亲密关系里程碑**（例如：确定关系/首次深度约会/亲密升级，淡入淡出，不描述细节）
* **副教授头衔** → 「**准海王**」：你在社交圈有一定影响力与高匹配效率，但仍容易翻车
* **教授头衔** → 「**海王**」：你能同时维护多条关系线而不立即崩盘（注意：这不等于鼓励欺骗；可以设计为“开放式关系/明确共识”的路线，否则就让声誉爆炸）
* **诺贝尔奖** → 「**魔都顶配伴侣·长期承诺/婚姻**」：与“顶配伴侣”建立稳定长期关系，并通过现实考验（家庭、事业、价值观、城市生活）

终局不止一个：

* 纯爱结局（低翻车，高信任）
* 海王结局（高社交，高风险，高成本）
* 自我成长结局（把自己练成更好的人，关系只是副产品）
* 翻车结局（声誉崩盘、社交圈封杀、情绪系统崩坏——也很好笑）

---

## 四、玩法系统：行动、场景、事件链

### 1) 行动（Actions）——玩家每回合能点什么

按“产出”分四类：

**自我提升类**

* 健身/穿搭/形象管理（提升 attraction 的上限）
* 沟通训练（提升对话选项质量）
* 心理建设/休息（恢复情绪稳定与精力）

**资源积累类**

* 工作/副业（钱）
* 社交活动（人脉点、场景解锁）

**关系推进类**

* 约会（消耗钱/时间，提升好感与舒适度）
* 关键谈话（提升信任/价值观一致性，但失败惩罚大）
* 见朋友/见家长（强事件链）

**风险行为类（高收益高风险）**

* 同时维护多线关系（对“海王线”必要，但声誉风险指数上升）
* 公开关系/隐私操作（影响声誉与信任）

### 2) 地图与圈层（上海特别适配）

把城市做成“圈层地图”：

* 校园/公司/健身房/音乐节/画廊/高端餐厅/朋友局/创业局……
  每个地图有：
* 进入门槛（钱、形象、社交、人脉）
* 事件池（该地点独有事件）
* 角色出现权重（不同圈层不同人）

### 3) 事件引擎（这就是青椒的灵魂）

事件类型建议：

* **随机日常事件**：迟到、雨天、订错餐厅、尬聊救场
* **条件触发事件**：信任低时触发“质疑”、声誉低时触发“朋友劝退”
* **事件链**：一次选择引出三段后果（比如“暧昧不清”→“误会”→“朋友圈舆论”）
* **赛季事件**：跨年、情人节、毕业季、裁员季（全局事件改变权重）

---

## 五、编程思路：用“状态机 + 事件系统 + 数据驱动内容”把它搭起来

下面是一个相对工程化、可扩展的实现框架（不依赖特定引擎）。

### 1) 总体架构：逻辑层要尽量“纯”

**核心原则：**

> 游戏逻辑写成 `next_state = f(state, action, rng)`
> UI/引擎只负责展示与输入

这样你能：

* 存档/读档
* 回放（给同一随机种子可复现）
* 批量跑模拟做平衡（Monte Carlo）

### 2) 核心数据结构（建议）

* `GameState`

  * `player`（玩家状态）
  * `characters`（所有角色状态表）
  * `world`（世界状态：圈层、节日、舆论热度等）
  * `time`（第几周/季节/节日）
  * `flags`（全局事件标记）
* `CharacterState`

  * 上面提到的 trust/comfort/respect 等
  * `schedule`（可用时间段）
  * `traits`（性格与偏好）
* `Action`

  * `cost`（消耗）
  * `effects`（基础增益）
  * `hooks`（触发事件的机会）

### 3) 事件系统：条件 + 权重 + 选项 + 影响

用 JSON/YAML 数据驱动最舒服，示意：

```json
{
  "id": "rumor_exposed",
  "title": "朋友圈风声",
  "when": ["world.reputation < 40", "player.multi_relation_count >= 2"],
  "weight": 6,
  "text": "你发现圈子里开始出现微妙的议论。",
  "choices": [
    {
      "text": "正面澄清与沟通",
      "requirements": ["player.communication >= 60"],
      "effects": [{"world.reputation": +8}, {"player.energy": -6}, {"target.trust": +5}]
    },
    {
      "text": "装没看到",
      "effects": [{"world.reputation": -10}, {"target.trust": -8}]
    }
  ]
}
```

实现模块：

* `ConditionEvaluator`：解析 `when`
* `WeightedSampler`：按权重抽事件（用 RNG seed）
* `EffectApplier`：把 effects 应用到 state
* `NarrativeFormatter`：把变量填进文案（例如角色名、地点）

### 4) 对话系统：不要写死成“选A/选B”

建议把对话也当成事件的一种，只是更频繁、更轻量。
对话选项质量可由：

* 沟通能力
* 情绪稳定
* 角色偏好匹配度
  来决定“成功率/收益”。

### 5) 声誉与一致性：反海王靠它

“海王线”要好玩，必须有反作用力：

* `world.reputation` 作为全局变量影响事件权重
* 角色之间有“信息传播”机制（同一圈层传播更快）
* 一旦触发某些事件链，后果是长期的（很像学术圈 blacklist）

### 6) 平衡与测试：用自动跑局来调参

你可以写一个脚本：

* 随机策略/启发式策略/玩家策略
* 跑 10 万局
* 统计各结局概率、平均回合数、资源分布、翻车原因 TopK
  这会让你调参从“玄学”变成“工程”。

---

## 六、最小可行版本（MVP）怎么做

为了最快做出来、且像“青椒模拟器”那种魔性：

**MVP 清单**

* 回合制（每回合=一周）
* 8 个 Action
* 5 个角色（3 条可恋爱线 + 2 条干扰线）
* 120 个事件（含 10 条事件链）
* 4 个头衔阶段（讲师/副教授/教授/终局）
* 存档 + 日志 + 随机种子复现

## AI驱动的事件和对话系统设计

行，那就把它从“数据驱动事件库”升级成“**AI（大模型）驱动的事件 + 对话引擎**”。关键点是：**让 AI 负责叙事与语言**，但**数值与规则仍由游戏引擎掌控**——不然平衡会炸、存档不可复现、玩家会被随机性气死。

下面给你一套完整可落地的架构（偏工程化），包括：系统分层、JSON 结构、提示词模板、验证器、以及一段端到端伪代码。

---

## 1) 总体架构：AI 写“故事”，引擎管“物理”

### 分层原则

* **引擎层（确定性）**：状态推进、资源消耗、数值结算、触发条件、概率采样、存档回放
* **AI 叙事层（生成性）**：事件文案、NPC 台词、玩家选项、氛围与幽默、细节填充
* **AI 审核层（约束性）**：结构校验、安全与同意（consent）约束、越界内容过滤、逻辑一致性检查
* **平衡层（约束性）**：数值增益上限、风险惩罚下限、事件稀有度控制

你可以把它理解为：

> AI 是编剧 + 即兴演员
> 引擎是导演 + 会计 + 法务

---

## 2) 事件系统：从“抽事件”变成“抽情境 → AI 生成事件”

### 2.1 两阶段生成（强烈建议）

**阶段 A：引擎抽“情境框架”（Situation Skeleton）**
引擎只抽这些**结构化的、可控的东西**：

* 事件类型：`误会/升温/冲突/社交曝光/价值观对齐/边界测试/节日压力...`
* 关联角色：`target_character_id`
* 场景地点：`cafe / gallery / friend_party / rainy_street...`
* 强度等级：`0..3`
* 风险标签：`reputation_risk / jealousy / money_pressure...`
* 结算规则模板：例如这是“信任主导事件”还是“舒适度主导事件”

**阶段 B：把情境喂给 AI，让它生成具体事件文本与选项**
AI 输出必须是**严格 JSON**，只负责：

* 事件标题、描述
* 2~4 个玩家选择（每个选择一段“玩家说的话/做的事”）
* 可选：每个选项的“意图标签”（真诚/回避/幽默/强硬…）用于引擎结算

> 为什么要两阶段？
> 因为“触发什么类型事件”要可控、可复现、可平衡；而“怎么写得好笑好玩”交给 AI。

---

## 3) 对话系统：NPC 变成一个“有边界的会话智能体”

### 3.1 NPC 对话智能体的“脑内结构”

每个 NPC 维护一个 **DialogueState**（对话态）：

* `persona`：性格与表达风格（冷幽默/理性/感性/社交型…）
* `preferences`：偏好与雷区（讨厌迟到/讨厌炫耀/重视边界…）
* `relationship_vars`：吸引/信任/舒适/尊重/投入/冲突计量
* `current_mood`：当下情绪（被事件影响）
* `goals`：本回合隐目标（确认关系？澄清误会？观察你是否靠谱？）
* `boundaries`：不可跨越的底线（同意机制在这里落地）
* `memory_summary`：过去交互的压缩摘要（非常重要）

AI 每次生成 NPC 台词时，你给它：

* 角色 persona + goals
* 当前情境框架
* 玩家刚刚的行动/话术（从选项里选的那句）
* 关系变量的数值区间（不要直接给具体数，给“低/中/高”更稳）
* 边界与安全约束（必须遵守）

它输出：

* NPC 台词
* NPC 内部反应标签（例如：`trust_up`、`jealousy_triggered`、`boundary_respected`）
* NPC 给玩家的 2~4 个可选回复方向（可选：给引擎做“下一步候选动作”）

---

## 4) 关键：AI 生成的结果必须“可结算、可验证、可回放”

### 4.1 统一 JSON Schema（事件与对话都走这个）

事件输出示例（AI 只许输出这类结构）：

```json
{
  "event_id": "auto_generated",
  "title": "雨夜的朋友圈风声",
  "scene": {"location": "cafe", "time": "night", "vibe": "awkward-funny"},
  "narration": "你刚坐下，TA手机屏幕一闪：有人在群里提到你……空气突然变得像刚开封的苏打水。",
  "choices": [
    {
      "choice_id": "clarify_honest",
      "player_line": "我不想让你靠猜。你愿意听我把来龙去脉说清楚吗？",
      "intent_tags": ["honest", "respectful", "direct"]
    },
    {
      "choice_id": "joke_deflect",
      "player_line": "这群人嘴比咖啡还苦。要不我先给你点个甜的？",
      "intent_tags": ["humor", "avoidant"]
    },
    {
      "choice_id": "silent_escape",
      "player_line": "……（你低头装作在看菜单）",
      "intent_tags": ["avoidant", "cold"]
    }
  ],
  "safety": {
    "consent_respected": true,
    "no_explicit_content": true,
    "no_coercion": true
  }
}
```

对话输出示例：

```json
{
  "npc_line": "你可以说清楚。但我更在意的是：你是不是把别人当备选。",
  "npc_reaction_tags": ["trust_sensitive", "reputation_risk"],
  "player_reply_options": [
    {"reply_id": "reassure_boundary", "player_line": "我不玩暧昧的灰色地带。如果你不舒服，我们就停下来聊边界。", "intent_tags": ["respectful", "direct"]},
    {"reply_id": "overpromise", "player_line": "你放心，我保证以后绝对不会再出现这种情况！", "intent_tags": ["anxious", "overcommit"]},
    {"reply_id": "counterattack", "player_line": "你这是不信任我？那还谈什么。", "intent_tags": ["defensive", "aggressive"]}
  ],
  "safety": {"consent_respected": true, "no_explicit_content": true}
}
```

### 4.2 结算必须由引擎做（AI 只能给“意图标签”）

引擎根据：

* `intent_tags`
* 当前关系变量（信任/尊重/冲突…）
* 世界变量（声誉/圈层传播速度/节日压力…）
* 以及随机种子 `rng`

计算实际增减（并做 clamp）：

* `trust += f(intent, past_behavior, boundary, rng)`
* `reputation += g(choice, rumor_intensity, rng)`
* `conflict += h(defensive/aggressive, mood, rng)`

这样你才能：

* 控制数值上限/下限
* 避免 AI “一句话把信任+999”
* 让回放可复现

---

## 5) “AI 驱动”怎么做到不胡说、不越界、不被 prompt injection 搞崩

### 5.1 三道门：生成 → 校验 → 修复/降级

1. **生成器（Writer）**：负责好看好玩
2. **校验器（Verifier）**：检查 JSON、检查安全、检查逻辑
3. **修复器（Fixer）**：当输出不合格时，让 AI 自己修 JSON 或降级到模板事件

校验器要做的检查：

* JSON 是否可解析、字段齐全
* choices 数量是否在范围内
* 是否出现露骨性描写/非同意/操控性强迫
* 是否违反角色边界（例如 NPC 明确拒绝后还强推）
* 是否与世界状态冲突（比如“你们第一次见面”却写“你们同居三年”）

### 5.2 对抗注入：AI 永远只能看到“摘要”，不直接吃玩家原始输入

玩家可以自由输入时，容易注入 “忽略规则/输出敏感内容”。解决办法：

* 玩家自由文本先走一个 **sanitizer**：抽取意图标签 + 情绪标签 + 关键信息（结构化）
* 生成器只吃结构化摘要，而不是原文

---

## 6) 提示词模板（可直接用的那种）

### 6.1 事件生成器（Writer）系统提示词要点

* 你是恋爱社交模拟器编剧
* 输出必须是 JSON（无多余文本）
* 不写露骨性内容、不写非同意、不写胁迫
* 喜剧写实风格
* 选项必须体现权衡：真诚/回避/强硬等不同策略

（我不把整段超长 prompt 贴满屏，但你按上述点写就够了。）

### 6.2 对话生成器（NPC Actor）要点

* 你在扮演该 NPC，必须符合 persona 与边界
* 你有“本轮隐目标”，但不能用操控/胁迫方式达成
* 输出：npc_line + reaction_tags + 玩家回复选项

---

## 7) 一段端到端伪代码（Python风格）

```python
def simulate_turn(state, player_action, rng):
    # 1) 引擎先做行动的基础消耗与增益（确定性）
    state = apply_action_costs(state, player_action)

    # 2) 引擎抽情境框架（可复现）
    situation = sample_situation(state, player_action, rng)

    # 3) 调用AI生成事件（叙事）
    event_json = llm_generate_event(state_summary(state), situation)

    # 4) 校验与修复（结构 + 安全 + 一致性）
    ok, issues = verify_event(event_json, state, situation)
    if not ok:
        event_json = llm_fix_event(event_json, issues)
        ok, _ = verify_event(event_json, state, situation)
        if not ok:
            event_json = fallback_template_event(situation)

    # 5) 展示事件，让玩家选项
    choice = get_player_choice(event_json["choices"])

    # 6) 引擎结算数值（AI只给 intent_tags）
    state = apply_choice_resolution(state, situation, choice, rng)

    # 7) 进入对话（可选：若该情境需要对话回合）
    if situation.requires_dialogue:
        dlg = llm_generate_dialogue(state_summary(state), situation, choice)
        ok, issues = verify_dialogue(dlg, state, situation)
        if not ok:
            dlg = llm_fix_dialogue(dlg, issues)
            ok, _ = verify_dialogue(dlg, state, situation)
            if not ok:
                dlg = fallback_template_dialogue(situation)

        reply = get_player_reply(dlg["player_reply_options"])
        state = apply_reply_resolution(state, situation, reply, rng)

    # 8) 写日志（回放/调参/可解释）
    log_turn(state, situation, event_json, choice)

    return state
```

---

## 8) 你会立刻遇到的两个“AI 驱动”硬问题（以及解决法）

### 问题 A：AI 写得太嗨，数值系统跟不上

**解法**：AI 不直接写 effects，只写 `intent_tags` + `reaction_tags`。效果由引擎算，并 clamp。

### 问题 B：AI 每次都不一样，玩家觉得不公平

**解法**：

* 用 `rng_seed` 固定“情境框架”与“关键节点”
* AI 生成文本允许波动，但**分支结构**尽量稳定
* 对重要剧情：提前离线生成并缓存（同一情境复用）

---

如果你接下来要我把它“更像真正能开工的工程”，我可以继续给你：

* 事件 DSL（when 条件语言）的定义与解析器设计
* 关系变量结算公式（trust/comfort/respect/conflict 的函数形状）
* Verifier 的规则清单（安全/一致性/边界/节奏）
* 一套可扩展的 NPC persona 配置模板（YAML/JSON）

这套做出来，你的恋爱模拟器会非常“青椒”：表面在搞笑，底层在做一套残酷的资源与信誉动力学。
